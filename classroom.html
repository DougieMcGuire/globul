<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Chat</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        #chat {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .msg {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.4;
            word-wrap: break-word;
        }
        .user {
            align-self: flex-end;
            background: #007aff;
            color: white;
        }
        .assistant {
            align-self: flex-start;
            background: white;
            color: black;
            border: 1px solid #e0e0e0;
        }
        #input-area {
            padding: 15px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }
        #input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 15px;
            outline: none;
        }
        #send {
            padding: 10px 25px;
            background: #007aff;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 15px;
        }
        #send:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div id="chat"></div>
    <div id="input-area">
        <input type="text" id="input" placeholder="Type a message..." />
        <button id="send">Send</button>
    </div>

    <script>
        const chat = document.getElementById('chat');
        const input = document.getElementById('input');
        const sendBtn = document.getElementById('send');
        let history = [];

        const systemPrompt = `You're having a natural conversation. Write like you're texting a friend - casual, authentic, with real personality. Mix up your sentence structures, use contractions naturally, and don't be afraid to rephrase or add "um" or "actually" occasionally. Sometimes acknowledge uncertainty or think things through out loud. Keep it real and conversational, not robotic or overly structured. Show genuine engagement and maintain your consistent voice throughout.`;

        function addMessage(role, content) {
            const div = document.createElement('div');
            div.className = `msg ${role}`;
            div.textContent = content;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        function buildPrompt(userMsg) {
            let prompt = systemPrompt + "\n\n";
            
            for (let msg of history) {
                if (msg.role === 'user') {
                    prompt += `Human: ${msg.content}\n\n`;
                } else {
                    prompt += `Assistant: ${msg.content}\n\n`;
                }
            }
            
            prompt += `Human: ${userMsg}\n\nAssistant:`;
            return prompt;
        }

        async function sendMessage() {
            const msg = input.value.trim();
            if (!msg) return;

            input.value = '';
            sendBtn.disabled = true;
            addMessage('user', msg);

            try {
                const fullPrompt = buildPrompt(msg);
                const encodedPrompt = encodeURIComponent(fullPrompt);
                const seed = Math.floor(Math.random() * 1000000);
                
                const url = `https://text.pollinations.ai/${encodedPrompt}?seed=${seed}&model=openai`;
                
                const res = await fetch(url);
                const data = await res.text();
                
                history.push({ role: 'user', content: msg });
                history.push({ role: 'assistant', content: data });
                
                addMessage('assistant', data);

            } catch (err) {
                addMessage('assistant', 'Sorry, something went wrong. Try again?');
            }

            sendBtn.disabled = false;
            input.focus();
        }

        sendBtn.onclick = sendMessage;
        input.onkeypress = (e) => {
            if (e.key === 'Enter') sendMessage();
        };
    </script>
</body>
</html>
